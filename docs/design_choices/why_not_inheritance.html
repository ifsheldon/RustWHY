<!DOCTYPE HTML>
<html lang="cn" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ä¸ºä»€ä¹ˆæ²¡æœ‰ç»§æ‰¿ï¼Ÿ - RustWHY</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../face.html"><strong aria-hidden="true">1.</strong> å°é¢</a></li><li class="chapter-item expanded "><a href="../preface.html"><strong aria-hidden="true">2.</strong> é¦–é¡µ</a></li><li class="chapter-item expanded "><a href="../engineering_features/opening.html"><strong aria-hidden="true">3.</strong> å·¥ç¨‹ç‰¹æ€§</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../engineering_features/why_associated_type.html"><strong aria-hidden="true">3.1.</strong> ä¸ºä»€ä¹ˆè¦æœ‰ Associate Typeï¼Ÿå®ƒå’Œæ™®é€šçš„æ³›å‹çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</a></li></ol></li><li class="chapter-item expanded "><a href="../design_choices/opening.html"><strong aria-hidden="true">4.</strong> è®¾è®¡é€‰æ‹©</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../design_choices/why_not_inheritance.html" class="active"><strong aria-hidden="true">4.1.</strong> ä¸ºä»€ä¹ˆæ²¡æœ‰ç»§æ‰¿ï¼Ÿ</a></li><li class="chapter-item expanded "><a href="../design_choices/why_not_global_variable.html"><strong aria-hidden="true">4.2.</strong> ä¸ºä»€ä¹ˆæ²¡æœ‰å…¨å±€å˜é‡ï¼Ÿ</a></li><li class="chapter-item expanded "><a href="../design_choices/why_not_overloading.html"><strong aria-hidden="true">4.3.</strong> ä¸ºä»€ä¹ˆæ²¡æœ‰é‡è½½ï¼Ÿ</a></li><li class="chapter-item expanded "><a href="../design_choices/why_not_parameter_defaults.html"><strong aria-hidden="true">4.4.</strong> ä¸ºä»€ä¹ˆæ²¡æœ‰ç¼ºçœå‚æ•°ï¼Ÿ</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">RustWHY</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="ä¸ºä»€ä¹ˆæ²¡æœ‰ç»§æ‰¿"><a class="header" href="#ä¸ºä»€ä¹ˆæ²¡æœ‰ç»§æ‰¿">ä¸ºä»€ä¹ˆæ²¡æœ‰ç»§æ‰¿ï¼Ÿ</a></h1>
<h2 id="èƒŒæ™¯"><a class="header" href="#èƒŒæ™¯">èƒŒæ™¯</a></h2>
<p>ç»§æ‰¿å¸¸å¸¸ç”¨äºé¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ä¹‹ä¸­ï¼Œé€šè¿‡ç»§æ‰¿ï¼Œä¸€ä¸ªå­ç±»å¯ä»¥è·å¾—çˆ¶ç±»çš„éƒ¨åˆ†ï¼ˆæˆ–å…¨éƒ¨ï¼‰çš„å±æ€§ã€æ•°æ®å’Œæ–¹æ³•ã€‚ç»§æ‰¿åˆå¯ä»¥åˆ†æˆå•ç»§æ‰¿å’Œå¤šç»§æ‰¿ã€‚ä¾‹å¦‚ï¼Œåœ¨ Java ä¸­ï¼Œå­ç±»åªèƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»ï¼Œæ‰€ä»¥å«å•ç»§æ‰¿ï¼Œè€Œåœ¨ C++ç­‰è¯­è¨€ä¸­ï¼Œä¸€ä¸ªå­ç±»å¯ä»¥æœ‰å¤šä¸ªçˆ¶ç±»ï¼Œæ‰€ä»¥å«å¤šç»§æ‰¿ã€‚</p>
<h2 id="ç­”æ¡ˆ"><a class="header" href="#ç­”æ¡ˆ">ç­”æ¡ˆ</a></h2>
<p>ä¸ºä»€ä¹ˆ Rust æ²¡æœ‰ç»§æ‰¿ï¼Ÿ</p>
<p>å¤ªé•¿ä¸çœ‹ç‰ˆå°±æ˜¯ï¼ˆä»<a href="https://doc.rust-lang.org/book/ch17-01-what-is-oo.html">Rust Book</a>æ‘˜å½•ï¼‰ï¼š</p>
<ul>
<li>ç»§æ‰¿æœ‰æ—¶å€™ä¼šå…±äº«è¿‡å¤šä¸œè¥¿ï¼ˆå¦‚ç”¨ä¸ä¸Šçš„å±æ€§ã€æ•°æ®ã€æ–¹æ³•ç­‰ï¼‰ã€‚æœ‰æ—¶å€™å­ç±»å¹¶ä¸éœ€è¦çˆ¶ç±»çš„æ‰€æœ‰ä¸œè¥¿ï¼ˆäººä¹Ÿæ˜¯ä¸€æ ·ï¼‰ã€‚</li>
<li>ç»§æ‰¿æœ‰ä¸€äº›é—®é¢˜éš¾ä»¥è§£å†³ã€‚</li>
<li>Rust ä¸éœ€è¦ç»§æ‰¿ä¹Ÿå¯ä»¥è¾¾åˆ°ç±»ä¼¼ç»§æ‰¿çš„ç›®çš„ï¼ˆä»£ç å…±äº«ã€å¤šæ€ï¼‰ã€‚</li>
</ul>
<p>é•¿ç­”æ¡ˆå°±æ˜¯çŸ­ç­”æ¡ˆçš„å®Œå…¨å±•å¼€ï¼Œä½†æ˜¯ä¸å…¶é—®ä¸ºä»€ä¹ˆä¸è¦ ï¼ˆâ€œWhy not?â€ï¼‰ï¼Œæˆ‘ä»¬å…ˆæ¥é—®ä¸€ä¸‹è‡ªå·±ï¼Œä¸ºä»€ä¹ˆè¦ï¼ˆâ€œWhy?â€ï¼‰ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸ºä»€ä¹ˆè¦æœ‰ç»§æ‰¿ï¼Ÿ</p>
<p>æœ‰çš„äººè¯´ï¼Œè¿™æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰çš„ç‰¹æ€§ã€‚ä½†æ˜¯ï¼Œåœ¨ Erich Gamma, Richard Helm, Ralph Johnson å’Œ John Vlissides (AKA gang of four) çš„ä¹¦ã€ŠDesign Patterns: Elements of Reusable Object-Oriented Softwareã€‹ä¸­ï¼Œä»–ä»¬è¿™æ ·å®šä¹‰OOPï¼š</p>
<blockquote>
<p>Object-oriented programs are made up of objects. An <em>object</em> packages both data and the procedures that operate on that data. The procedures are typically called <em>methods</em> or <em>operations</em>.</p>
</blockquote>
<p>ä»–ä»¬å‹æ ¹æ²¡æåˆ°ç»§æ‰¿ã€‚ï¼ˆå¦‚æœæœ‰äººè´¨ç–‘æƒå¨æ€§çš„è¯ï¼Œå¯ä»¥æŸ¥æŸ¥ Gang of Fourï¼‰</p>
<p>å¼•ç”¨ Rust Book çš„è§‚ç‚¹ï¼Œç»§æ‰¿çš„ç›®çš„åªæœ‰ä¸¤ç‚¹ï¼š</p>
<ol>
<li>ä»£ç å¤ç”¨</li>
<li>å¤šæ€</li>
</ol>
<p>å…¶å®å¤šæ€åœ¨<strong>ä¸€å®šç¨‹åº¦</strong>ä¸Šä¹Ÿå¯ä»¥è¯´æ˜¯ä¸ºäº†ä»£ç å¤ç”¨ï¼Œæ‰€ä»¥ç»ˆæçš„åŸå› è¿˜æ˜¯ä»£ç å¯å¤ç”¨ã€‚æ‰€ä»¥è¿™ä¹Ÿè¡¨ç°åœ¨ç»§æ‰¿çš„å…·ä½“å®ç°ä¸Šäº†ã€‚é€šè¿‡ç»§æ‰¿ï¼Œç¨‹åºå‘˜å¯ä»¥ä¸ç”¨å†™çˆ¶ç±»å·²ç»æœ‰çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨å£°æ˜çˆ¶ç±»å·²ç»æœ‰çš„å±æ€§ï¼Œè¿™å°±è®©ä»£ç æ›´åŠ èƒ½è¢«å¤ç”¨äº†ã€‚</p>
<p>é‚£ä¹ˆçœ‹èµ·æ¥ç»§æ‰¿å…¨æ˜¯å¥½å¤„ï¼Œæ‰€ä»¥ç¨‹åºå‘˜å’Œç»§æ‰¿ forever and forever 100 years!? </p>
<p>è¿™æ—¶å€™å­¦è¿‡è½¯ä»¶å·¥ç¨‹çš„åŒå­¦åº”è¯¥ä¼šæ¬å‡ºä¸€ä¸ªè¯æ¥åé©³äº†ï¼Œé‚£å°±æ˜¯â€œè€¦åˆâ€(Coupling)ã€‚â€œè€¦åˆâ€è¯´çš„æ˜¯ç»„ä»¶ä¹‹é—´çš„ä¾èµ–ç¨‹åº¦ï¼Œé‚£ä¹ˆï¼Œå¦‚æœæŠŠçˆ¶ç±»å’Œå­ç±»çœ‹æˆæ˜¯ä¸¤ä¸ªç»„ä»¶ï¼Œé‚£ä¹ˆä»–ä»¬ä¹‹é—´çš„è€¦åˆåº”è¯¥æ˜¯æœ€é«˜çš„ï¼Œä¹Ÿå°±æ˜¯ä¾èµ–ç¨‹åº¦æœ€é«˜ã€‚è€Œé«˜è€¦åˆä¸€èˆ¬æ˜¯è®¤ä¸ºä¸å¥½çš„ï¼Œå°±ä¸å±•å¼€è®²äº†ã€‚ä¸¾ä¸ªä¸æ°å½“çš„ä¾‹å­ï¼Œå°æ—¶å€™ä¹°ä¸œè¥¿éƒ½è¦çˆ¸å¦ˆå‡ºé’±ï¼Œè€Œçˆ¸å¦ˆ diss ä½ åˆ°äº†æœ€åæ€»æ˜¯ä¼šå›åˆ°ä¸€å¥è¯â€œä½ åƒæˆ‘çš„ç©¿æˆ‘çš„è¿˜è¿™ä¹ˆä¸å¬è¯â€œï¼Œè€Œå°±ç®—å ç†çš„æ˜¯ä½ ï¼Œä¹Ÿåªèƒ½è®¤æ€‚ã€‚è¿™å°±æ˜¯é«˜è€¦åˆçš„åå¤„ğŸ¶</p>
<p>æ‰€ä»¥é¡ºç€é«˜è€¦åˆçš„åå¤„ï¼Œæˆ‘ä»¬æ¥åˆ°äº†ç»§æ‰¿æœºåˆ¶çš„åå¤„ï¼Œä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä¸ï¼ˆâ€Why notâ€œï¼‰ã€‚</p>
<p>é¦–å…ˆï¼Œç¬¬ä¸€ä¸ªç†ç”±å°±æ˜¯é«˜è€¦åˆã€‚å¼•ç”³å‡ºæ¥çš„é—®é¢˜å°±æ˜¯ï¼Œæœ‰æ—¶å€™å­ç±»å¹¶ä¸éœ€è¦çˆ¶ç±»çš„æ‰€æœ‰ä¸œè¥¿ï¼Œä½†æ˜¯ç»§æ‰¿ä¸€è‚¡è„‘éƒ½æŠŠçˆ¶ç±»çš„ä¸œè¥¿å¡ç»™å­ç±»äº†ã€‚å¤§å®¶éƒ½çŸ¥é“ï¼Œæ²¡æœ‰å…è´¹çš„åˆé¤ï¼Œæ‰€ä»¥ç»§æ‰¿çš„ä¸œè¥¿ä¹Ÿä¸æ˜¯è¶Šå¤šè¶Šå¥½ã€‚ä¾‹å¦‚ï¼Œç»§æ‰¿æ–¹æ³•ï¼Œä¸‡ä¸€å­ç±»éœ€è¦å†™ä¸€ä¸ªåŒåæ–¹æ³•ï¼Œä½†æ˜¯æœ‰ç€ä¸åŒçš„è¾“å…¥è¾“å‡ºæ€ä¹ˆåŠï¼Ÿæœ‰äººè¯´å¯ä»¥ç”¨é‡è½½ï¼Œä½†æ˜¯å¤æ‚åº¦åˆå¢åŠ äº†ã€‚</p>
<p>ç¬¬äºŒä¸ªï¼Œç»§æ‰¿æ–¹æ³•è¿˜æœ‰ä¸€äº›éš¾å ªçš„æƒ…å½¢ä¸èƒ½è§£å†³ã€‚ä¾‹å¦‚ï¼Œç»å…¸çš„åœ†-æ¤­åœ†é—®é¢˜ï¼ˆ<a href="https://en.wikipedia.org/wiki/Circle%E2%80%93ellipse_problem">Circle-Ellipse Problem</a>ï¼‰ã€‚å¤§å®¶éƒ½çŸ¥é“ï¼Œåœ†æ˜¯æ¤­åœ†ï¼Œé‚£ä¹ˆï¼ŒæŒ‰ç…§ç»§æ‰¿çš„æ€è·¯ï¼Œåœ†å°±åº”è¯¥æ˜¯æ¤­åœ†çš„å­ç±»ã€‚åŒæ—¶æˆ‘ä»¬çŸ¥é“ï¼Œæ— è®ºæ¤­åœ†æ€ä¹ˆåœ¨ä¸»è½´ä¸Šä¼¸ç¼©ï¼ˆé™¤äº†é›¶å˜æ¢ï¼‰ï¼Œå®ƒä¾æ—§æ˜¯ä¸ªæ¤­åœ†ã€‚é‚£ä¹ˆæ¤­åœ†å°±åº”è¯¥æœ‰ä¸€ä¸ªæ–¹æ³•å«</p>
<p><code>Ellipse::stretch(stretch_principal_direction0:f32, stretch_principal_direction1:f32)</code></p>
<p>ç„¶è€Œï¼Œå¦‚æœåœ†ä¹Ÿç»§æ‰¿äº†è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰åœ†ä¼¸ç¼©äº†ä¹‹åè¿˜æ˜¯åœ†çš„å¥‡æ€ªæƒ…å½¢ã€‚è¿™åœ¨å®è·µä¸­å¾®ä¸è¶³é“ï¼ŒæŠ›ä¸ª Exception å°±å®Œäº†ï¼Œä½†æ˜¯è¿™æ˜¯ä½¿ç”¨ç»§æ‰¿å¸¦æ¥çš„ç†è®ºä¸Šçš„æ ¹æœ¬é—®é¢˜ä¹‹ä¸€ã€‚</p>
<p>ç¬¬ä¸‰ä¸ªç†ç”±æ˜¯ï¼Œå¦‚æœä¸€ä¸ªç¼–ç¨‹è¯­è¨€å…è®¸å¤šç»§æ‰¿ï¼Œé‚£ä¹ˆè¿˜ä¼šæœ‰<a href="https://en.wikipedia.org/wiki/Multiple_inheritance#The_diamond_problem">è±å½¢ç»§æ‰¿é—®é¢˜</a>ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚</p>
<p>æœ€åä¸€ä¸ªç†ç”±æ˜¯ï¼Œå½“ç»§æ‰¿çš„å±‚çº§è¿‡å¤šï¼Œè®°å¿†ã€ç®¡ç†ç»§æ‰¿ä¸‹æ¥çš„å±æ€§å’Œæ–¹æ³•å°±éå¸¸éº»çƒ¦ï¼Œä½¿å¾—ä»£ç æ›´éš¾è¯»æ‡‚ï¼Œæ›´éš¾ç†è§£ã€‚æˆ–è®¸æœ‰äººä¹Ÿæ›¾é‡åˆ°è¿‡æˆ‘è¿™æ ·çš„æƒ…å†µï¼Œæ¥æ‰‹æˆ–å­¦ä¹ åˆ«äººçš„ä»£ç çš„æ—¶å€™ï¼Œçœ‹åˆ°åˆ«äººåœ¨ä»£ç é‡Œç”¨äº†ä¸€ä¸ªå±æ€§æˆ–è€…æ–¹æ³•ï¼Œä½†æ˜¯åœ¨å½“å‰ç±»ä¸­æ‰¾ä¸åˆ°ï¼Œæœ€åå‘ç°æ˜¯å®šä¹‰åœ¨äº†çˆ¶ç±»ä¸­ï¼ˆç”šè‡³çˆ¶ç±»çš„çˆ¶ç±»ï¼Œç”šè‡³æ›¾ç¥–çˆ¶ç±»ä¸­ï¼‰ã€‚è€Œå¦‚æœæƒ³è¦å®šä¹‰ä¸€ä¸ªå­ç±»ï¼Œå†™ä¸€ä¸ªæ–¹æ³•ï¼Œæ²¡å‡†å°±æ˜¯åœ¨é‡å¤é€ è½®å­ï¼Œåˆ«äººæ—©æ—©å°±åœ¨ä½ ç»§æ‰¿çš„çˆ¶ç±»ï¼ˆæˆ–è€…ç¥–çˆ¶ç±»ï¼Œæ›¾ç¥–çˆ¶ç±»ï¼‰ä¸­å†™å¥½äº†ï¼Œåªæ˜¯ç”¨äº†ä¸€ä¸ªä¸åŒçš„åå­—ã€‚</p>
<p>å¦å¤–ä¸€ä¸ªï¼Œå€¼å¾—åæ€çš„æ˜¯ï¼Œä¸ºä»€ä¹ˆç»§æ‰¿å°±ä¸€å®šä¼šæŠŠå±æ€§å’Œæ–¹æ³•éƒ½ç»§æ‰¿äº†ï¼Ÿå±æ€§æ˜¯ä¸€ä¸ªç±»éœ€è¦çš„æ•°æ®ï¼Œæ–¹æ³•æ˜¯ä¸€ä¸ªç±»çš„è¡Œä¸ºï¼Œæ•°æ®å’Œè¡Œä¸ºå¯èƒ½æœ‰å…³ä¹Ÿå¯èƒ½æ— å…³ï¼Œä¸ºä»€ä¹ˆè¦æ†ç»‘ä¸€èµ·ä½œä¸ºç»§æ‰¿å¤§ç¤¼åŒ…ï¼Ÿ</p>
<p>æ‰€ä»¥ï¼ŒåŸºäºä¸Šé¢çš„ç†ç”±ï¼ŒRust é€‰æ‹©å®Œå…¨æŠ›å¼€ç»§æ‰¿çš„æ¦‚å¿µï¼Œ<strong>é‡æ–°å®¡è§†</strong>å¦‚ä½•æ›´å¥½åœ°å¤ç”¨ä»£ç ã€‚</p>
<p>é¦–å…ˆï¼Œå¯¹äºä»£ç å¤ç”¨ï¼ŒRust Book ä¸­æåˆ°å¯ä»¥ä½¿ç”¨<code>trait</code>ï¼Œå› ä¸º<code>trait</code>å¯ä»¥æœ‰é»˜è®¤å®ç°ï¼Œå¦‚æœä¸æƒ³é‡æ–°å†™ä»£ç ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨é»˜è®¤å®ç°å°±å¥½äº†ã€‚å¦å¤–<code>trait</code>è¿˜å¯ä»¥æœ‰Super Traitï¼ˆä»‹ç»è§ <a href="https://doc.rust-lang.org/book/ch19-03-advanced-traits.html#using-supertraits-to-require-one-traits-functionality-within-another-trait">Rust Book - super trait</a>ï¼‰ï¼Œå°±å¯ä»¥å®šä¹‰<code>trait</code>ä¹‹é—´çš„å±‚çº§ã€‚æœ‰äººè¯´ï¼Œé‚£ Super Trait ä¸å°±æ˜¯åƒç»§æ‰¿äº†å—ï¼Ÿè¿™ä¸ªé—®é¢˜æˆ‘ä»¬åœ¨é™„å½•ä¸­è®¨è®ºã€‚</p>
<p>å¯¹äºå¤šæ€ï¼ŒRust Book é‡Œæå‡ºå¯ä»¥ä½¿ç”¨æ³›å‹åŠ  Trait Boundã€‚</p>
<blockquote>
<p>To many people, polymorphism is synonymous with inheritance. But itâ€™s actually a more general concept that refers to code that can work with data of multiple types. For inheritance, those types are generally subclasses.</p>
<p>Rust instead uses generics to abstract over different possible types and trait bounds to impose constraints on what those types must provide. This is sometimes called <em>bounded parametric polymorphism</em>.</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯å¤šæ€å¯ä»¥ç”±æ³›å‹åŠ ä¸Š Trait çš„é™åˆ¶æ¥å®ç°ã€‚</p>
<p>éœ€è¦è¡¥å……çš„æ˜¯ï¼ŒRust Book è¯´çš„å¤šæ€æ›´å¤šçš„æ˜¯é™æ€å¤šæ€ï¼Œå°±æ˜¯ç¼–è¯‘æ—¶å¯ä»¥å®ç°çš„å¤šæ€ã€‚è€Œå¦‚æœæƒ³è¦å®ç°åƒ Java ä¸€æ ·çš„å¤šæ€ï¼ˆä¾‹å¦‚ï¼Œå‘ä¸€ä¸ª Vector é‡Œæ·»åŠ æœ‰ç€å…±åŒçˆ¶ç±»çš„ä¸åŒå­ç±»çš„å¯¹è±¡ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦è¿è¡Œæ—¶å¤šæ€ã€‚è€Œåœ¨ Rust ä¸­ï¼Œâ€è¿è¡Œæ—¶å¤šæ€â€œæ˜¯ç”± Dynamic Dispatch å’Œ <a href="https://doc.rust-lang.org/book/ch17-02-trait-objects.html#using-trait-objects-that-allow-for-values-of-different-types">Trait Object</a> å®ç°çš„ã€‚</p>
<p>è¿™æ ·åšï¼ŒRust é™ä½äº†ç»§æ‰¿çš„é«˜è€¦åˆã€‚ä¸€ä¸ªç±»å‹å®ç°ä¸€ä¸ª<code>trait</code>å¹¶ä¸ä¼šæŠŠä¸éœ€è¦çš„æ–¹æ³•ä¹Ÿç»§æ‰¿ä¸‹æ¥ï¼Œè€Œå› ä¸º<code>trait</code>ä¸å¸¦å±æ€§ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šç»§æ‰¿å±æ€§ã€‚</p>
<p>è€Œæ²¡æœ‰äº†ç»§æ‰¿ï¼Œè±å½¢ç»§æ‰¿çš„æ•°æ®é—®é¢˜å½“ç„¶ä¹Ÿä¸å¤å­˜åœ¨äº†ã€‚è€Œ Super Trait å¸¦æ¥çš„æ–¹æ³•ä¸Šçš„è±å½¢ç»§æ‰¿é—®é¢˜æˆ‘ä»¬ä¹Ÿä¼šåœ¨é™„å½•è®¨è®ºã€‚</p>
<p>å¯¹äºåœ†-æ¤­åœ†é—®é¢˜ï¼Œåœ¨ Rust ä¸­<code>struct Circle</code>å¯ä»¥åŒ…å«ä¸€ä¸ª<code>Ellipse</code>çš„å±æ€§ï¼Œä½†æ˜¯å¯ä»¥é€‰æ‹©ä¸æŠŠä¸€äº›æ¤­åœ†çš„æ–¹æ³•æš´éœ²å‡ºæ¥ï¼Œè¿™å°±è§£å†³äº†åœ†-æ¤­åœ†é—®é¢˜ã€‚å°±åƒè¿™æ ·:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct Ellipse{
    // zip
}
impl Ellipse{
    pub fn area(&amp;self){
        // zip
    }
    pub fn stretch(&amp;mut self){
        // zip
    }
}
pub struct Circle{
    e: Ellipse
}

impl Circle{
    pub fn area(&amp;self){
        self.e.area()
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>äº‹å®ä¸Šï¼ŒRust çš„ç¼–ç¨‹å»ºæ¨¡æ¨¡å¼æ›´åƒæ˜¯ç»„åˆï¼ˆCompositionï¼‰ è€Œä¸æ˜¯ç»§æ‰¿ï¼ˆInheritanceï¼‰ã€‚ç»§æ‰¿ä½¿ç”¨çš„æ˜¯éšå¼â€å¤åˆ¶ä»£ç â€œï¼Œè€Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¨‹åºå‘˜è¦æ˜¾å¼åœ°åœ¨<code>Circle::area</code>ä¸­è°ƒç”¨<code>Ellipse::area</code>ã€‚è™½ç„¶å¤šä½™çš„ä»£ç å†™å¤šäº†ä¸€ç‚¹ç‚¹ï¼Œä½†æ˜¯å¯ä»¥æ¸…æ™°åœ°æŒ‡å‡ºä¾èµ–å±‚çº§ã€‚</p>
<p>è¿™æ ·ï¼Œå°±ç®— Composition çš„å±‚çº§å†å¤šï¼Œçœ‹ä»£ç çš„æ—¶å€™æ€»èƒ½è¿½è¸ªå›åŸæ¥çš„å®ç°ï¼Œå°±åƒæ˜¯ä¸Šé¢<code>Circle::area</code>åˆ°<code>Ellipse::area</code>ä¸€æ ·ã€‚è™½ç„¶å±‚çº§è¿‡å¤šæ—¶ï¼Œéš¾ä»¥ç®¡ç†ä»£ç çš„é—®é¢˜ä¾æ—§å­˜åœ¨ï¼Œä½†æ˜¯è‡³å°‘å¯ä»¥å‡ç¼“ä¸€ç‚¹ã€‚</p>
<p>ç»¼ä¸Šï¼ŒRust æŠ›å¼ƒäº†ç»§æ‰¿ï¼Œé€‰æ‹©äº†ç»“åˆ<code>trait</code>ã€æ³›å‹å’ŒTrait Bound çš„ç»„åˆï¼ˆCompositionï¼‰æ¨¡å¼ï¼Œè§£å†³äº†å¤§éƒ¨åˆ†ç»§æ‰¿å¸¦æ¥çš„é—®é¢˜ï¼ŒåŒæ—¶å°½é‡ä¸å¼•å…¥å¤ªå¤šçš„æ–°é—®é¢˜ã€æ–°é™åˆ¶ï¼Œæé«˜çµæ´»åº¦çš„åŒæ—¶ä¹Ÿå°½é‡ä¿æŒäº†ä»£ç çš„å¯å¤ç”¨æ€§ã€‚</p>
<p>æœ‰äººè¯´ï¼Œæœ‰é“ç†ï¼Œä½†æ˜¯æˆ‘å°±æƒ³è¦ç»§æ‰¿ï¼Œæˆ‘è¿ä¸Šé¢<code>Circle::area</code>è¿™æ ·çš„å§”æ‰˜å‡½æ•°ï¼ˆdelegateï¼‰éƒ½ä¸æƒ³å†™ï¼Œé‚£å¯ä»¥æ€ä¹ˆåŠï¼Ÿå‚è§é™„å½•ä¸­çš„<code>Deref</code> Anti-patternã€‚</p>
<h2 id="ç›¸å…³é“¾æ¥"><a class="header" href="#ç›¸å…³é“¾æ¥">ç›¸å…³é“¾æ¥</a></h2>
<ul>
<li>Rust ç¤¾åŒºä¸­çš„è®¨è®º <a href="https://users.rust-lang.org/t/how-to-implement-inheritance-like-feature-for-rust/31159">how to implement inheritance-like feature for rust</a></li>
<li>Rust Bookç›¸å…³é“¾æ¥ï¼Œè¯·çœ‹æ­£æ–‡ä¸­çš„é“¾æ¥</li>
</ul>
<h2 id="é™„å½•"><a class="header" href="#é™„å½•">é™„å½•</a></h2>
<h3 id="super-trait-å’Œç»§æ‰¿æœ‰ä»€ä¹ˆä¸åŒ"><a class="header" href="#super-trait-å’Œç»§æ‰¿æœ‰ä»€ä¹ˆä¸åŒ">Super Trait å’Œç»§æ‰¿æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</a></h3>
<ul>
<li>
<p>Super Trait è¿˜æ˜¯å±äº Traitï¼Œæ‰€ä»¥å®ƒä¸èƒ½å®šä¹‰å±æ€§ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šâ€ç»§æ‰¿â€œå±æ€§ã€‚</p>
</li>
<li>
<p>Super Trait å®šä¹‰çš„æ˜¯è¡Œä¸ºï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç±»å‹åº”è¯¥æœ‰çš„æ–¹æ³•ï¼Œç”±æ­¤å½¢æˆçš„ Trait çš„å±‚çº§æ˜¯è¡Œä¸ºä¸Šçš„å±‚çº§ã€‚è€Œç»§æ‰¿ä¸ä»…ä¼šç»§æ‰¿æ–¹æ³•ï¼Œè¿˜ä¼šç»§æ‰¿å±æ€§ï¼Œå¼•å…¥äº†æ›´å¤šè€¦åˆï¼Œè¿˜ä¼šå¼•å…¥è±å½¢ç»§æ‰¿ä¸­çš„æ•°æ®é—®é¢˜ã€‚</p>
</li>
<li>
<p>è™½ç„¶ super trait åŒæ ·ä¼šæœ‰è±å½¢ç»§æ‰¿é—®é¢˜ï¼Œä½†æ˜¯ä¸åƒæ•°æ®çš„é—®é¢˜é‚£æ ·éš¾ä»¥è§£å†³ï¼Œæ–¹æ³•ä¸Šçš„å†²çªç”¨<a href="https://doc.rust-lang.org/book/ch19-03-advanced-traits.html#fully-qualified-syntax-for-disambiguation-calling-methods-with-the-same-name">Fully qualified syntax</a>å°±å¯ä»¥è§£å†³ã€‚ä¾‹å¦‚:</p>
<pre><pre class="playground"><code class="language-rust">pub trait Say {
    fn say_something(&amp;self) {
        println!(&quot;yummy&quot;)
    }
}

pub trait EatApple: Eat + Say {
    fn eat_something(&amp;self) {
        println!(&quot;Eat something, maybe Apple?&quot;);
        self.say_something()
    }
    fn eat_apple(&amp;self) {
        println!(&quot;Eat Apple&quot;)
    }
}

pub trait EatPear: Eat + Say {
    fn eat_something(&amp;self) {
        println!(&quot;Eat something, maybe Pear?&quot;);
        self.say_something()
    }
    fn eat_pear(&amp;self) {
        println!(&quot;Eat pear&quot;)
    }
}

struct People;

impl Eat for People {}

impl Say for People {}

impl EatPear for People {}

fn main() {
    let p = People;
    Eat::eat_something(&amp;p); // OK
    p.eat_something() // compile error
}
</code></pre></pre>
</li>
</ul>
<h3 id="deref-anti-pattern"><a class="header" href="#deref-anti-pattern"><code>Deref</code> Anti-pattern</a></h3>
<p>å‚è€ƒè‡ª <a href="https://rust-unofficial.github.io/patterns/anti_patterns/deref.html">Rust Design Patterns</a>ã€‚</p>
<p>å¤ªé•¿ä¸çœ‹ç‰ˆï¼š</p>
<p>Rust ä¸­<code>Deref</code>æ˜¯è¿™æ ·å®šä¹‰çš„ï¼Œä¸€èˆ¬ç”¨æ¥å®ç°æ™ºèƒ½æŒ‡é’ˆï¼Œæ¯”å¦‚è¯´<code>Box&lt;T&gt;</code>å°±å¯ä»¥å®ç°<code>Deref</code>å¹¶ä¸”è®©<code>Target=T</code>ã€‚</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub trait Deref {
    type Target: ?Sized;
    fn deref(&amp;self) -&gt; &amp;Self::Target;
}
<span class="boring">}
</span></code></pre></pre>
<p>ä½†æ˜¯æ—¢ç„¶å¯ä»¥éšä¾¿æŒ‡å®š<code>Target</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ»¥ç”¨è¿™ä¸ªæ¥æ¨¡æ‹Ÿç»§æ‰¿ï¼Œåƒè¿™æ ·ï¼ˆä¾‹å­æ¥è‡ªäºå‚è€ƒï¼‰ï¼š</p>
<pre><pre class="playground"><code class="language-rust">struct Foo {}

impl Foo {
    fn m(&amp;self) {
        //..
    }
}

struct Bar {
    f: Foo,
}

impl Deref for Bar {
    type Target = Foo;
    fn deref(&amp;self) -&gt; &amp;Foo {
        &amp;self.f
    }
}

fn main() {
    let b = Bar { f: Foo {} };
    b.m();
}
</code></pre></pre>
<p>é‚£ä¹ˆ<code>b.m()</code>å°±å®é™…ä¸Šæ˜¯<code>b.deref().m()</code>ï¼Œä»è€Œå®é™…ä¸Šå®ç°äº†ç»§æ‰¿æ–¹æ³•çš„ä½œç”¨ã€‚</p>
<p>ä½†æ˜¯è¿™ç§ç”¨æ³•å±äºæ»¥ç”¨ï¼Œ<strong>å¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨</strong>ã€‚åœ¨ä¸€ä¸ª <code>crate</code> é‡Œï¼Œ<code>impl</code> å’Œ <code>struct</code> å®šä¹‰å—å¸¸å¸¸å¯ä»¥åˆ†å¼€ï¼Œè¿™é€šå¸¸é—®é¢˜ä¸å¤§ï¼Œå› ä¸º IDE å¯ä»¥å¸®å¿™æœç´¢å‡ºä¸€ä¸ªç±»å‹çš„æ–¹æ³•å®šä¹‰åœ¨å“ªä¸ª <code>impl</code> å—é‡Œã€‚ç„¶è€Œï¼Œ<code>Deref</code> æ˜¯ä¸€ä¸ªå¾®å¦™çš„è¯­æ³•ç³–ï¼ŒIDE ä¸ä¸€å®šèƒ½ä» <code>b.m()</code> å¸®å¿™æ‰¾åˆ° <code>Foo::m</code> ï¼Œè€Œä½ å¯ä»¥æŠŠ <code>struct Foo</code> å’Œ <code>struct Bar</code> çš„å®šä¹‰åˆ†å¼€æ”¾å¹¶ä¸”æŠŠ <code>impl Deref for Bar</code> ä»£ç å—æ”¾åœ¨é¡¹ç›®é‡Œåä¸‡å…«åƒé‡Œå¤–çš„åœ°æ–¹ã€‚ç›¸ä¿¡æ²¡æœ‰äººæƒ³é‡ä¸Šè¿™æ ·çš„çŠ¶å†µï¼Œæ‰€ä»¥å·±æ‰€ä¸æ¬²å‹¿æ–½äºäººï¼ŒLove and Peaceâ¤ï¸</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../design_choices/opening.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../design_choices/why_not_global_variable.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../design_choices/opening.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../design_choices/why_not_global_variable.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
